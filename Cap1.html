<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Visualización de Datos con ggplot2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Seminario de R para la Ciencia de Datos</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Prelim.html">Preliminares</a>
</li>
<li>
  <a href="Cap1.html">Cap_1</a>
</li>
<li>
  <a href="Cap2.html">Cap_2</a>
</li>
<li>
  <a href="Cap3.html">Cap_3</a>
</li>
<li>
  <a href="Cap4.html">Cap_4</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Visualización de Datos con ggplot2</h1>

</div>


<pre class="r"><code>if(!require(tidyverse)){
  install.packages(&#39;tidyverse&#39;)
  require(tidyverse)
} else{
    require(tidyverse)
}
if(!require(maps)){
  install.packages(&#39;maps&#39;)
  require(maps)
} else{
  require(maps)
}</code></pre>
<p>El paquete <strong>ggplot</strong> es uno de los sistemas más versátiles y elegantes para hacer gráficas en R. Para más detalles teóricos de <strong>ggplot</strong> se recomienda leer <a href="http://vita.had.co.nz/papers/layered-grammar.pdf">A Layered Grammar of Graphics</a>.</p>
<div id="primeros-pasos" class="section level2">
<h2>Primeros pasos</h2>
<p>Tratemos de responder a la siguiente pregunta: Cómo es la relación entre el tamaño del motor y la eficiencia de combustible? Es positiva? Negativa? Lineal? No lineal?</p>
<p>Primero se carga el ‘data.frame’ mpg con los datos de autos.</p>
<pre class="r"><code>#mpg</code></pre>
<p>Las variables displ (tamaño del motor en litros) y hwy (eficiencia de combustible en la autopista en millas por galón) permitiran explorar la respuesta a la pregunta.</p>
</div>
<div id="creacion-de-un-ggplot" class="section level2">
<h2>Creación de un ggplot</h2>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Una plantilla de gráfica sería: ggplot(data = <DATA>) + <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>)).</p>
</div>
<div id="ejercicios" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Corra ggplot(data = mpg). Qué muestra?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Cuántas filas hay en el conjunto de datos mtcars?</li>
</ol>
<pre class="r"><code>nrow(mtcars)</code></pre>
<pre><code>## [1] 32</code></pre>
<p>Cuántas columnas?</p>
<pre class="r"><code>ncol(mtcars)</code></pre>
<pre><code>## [1] 11</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Qué describe la variable drv? Lea la ayuda para mpg usando el comando ?mpg.</li>
</ol>
<pre class="r"><code>#?mpg</code></pre>
<p>drv es una variable categórica que indica el tipo de tracción en las ruedas: f = tracción en las ruedas delanteras, r = tracción en las ruedas traseras, 4 = tracción en las cuatro ruedas.</p>
<ol start="4" style="list-style-type: decimal">
<li>Haga un diagrama de dispersión de hwy vs. cyl.</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = cyl, y = hwy))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Qué sucede si se hace un diagrama de dispersión de class vs. drv? Por qué este gráfico no es útil?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = class, y = drv))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Este gráfico no es útil porque solo muestra donde hay datos en una tabla de dos vías para variables categóricas.</p>
</div>
<div id="mapeos-esteticos" class="section level2">
<h2>Mapeos Estéticos</h2>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = class))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Una Estética es una propiedad visual de los objetos en una gráfica, como por ejemplo el tamaño, la forma o el color de los puntos.</p>
<p>Veamos ahora el mismo ejemplo cambiando la Estética size:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, size = class))</code></pre>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Cambiemos ahora la transparencia de los puntos con la Estética alpha:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, alpha = class))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>O la forma de los puntos con la Estética shape:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, shape = class))</code></pre>
<pre><code>## Warning: The shape palette can deal with a maximum of 6 discrete values
## because more than 6 becomes difficult to discriminate; you have 7.
## Consider specifying shapes manually if you must have them.</code></pre>
<pre><code>## Warning: Removed 62 rows containing missing values (geom_point).</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Las Estéticas se pueden configurar manualmente:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy), color = &quot;blue&quot;)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Note que esto se hace por fuera de la función aes().</p>
</div>
<div id="ejercicios-1" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Qué es incorrecto en el siguiente código? Por qué los puntos no son azules?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = &quot;blue&quot;))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Observe que la estética color se colocó dentro de la función aes() y eso no es correcto.</p>
<ol start="2" style="list-style-type: decimal">
<li>Cuáles variables en mpg son categóricas? Cuáles son continuas? (Ayuda: ver ?mpg) Cómo puede ver esto al correr mpg?</li>
</ol>
<pre class="r"><code>#?mpg</code></pre>
<p>Categóricas: manufacturer, model, year, trans, drv, fl, class. Continuas: displ, cyl, cty, hwy.</p>
<pre class="r"><code>mpg</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model    displ  year   cyl trans   drv     cty   hwy fl   
##    &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;
##  1 audi         a4         1.8  1999     4 auto(l~ f        18    29 p    
##  2 audi         a4         1.8  1999     4 manual~ f        21    29 p    
##  3 audi         a4         2    2008     4 manual~ f        20    31 p    
##  4 audi         a4         2    2008     4 auto(a~ f        21    30 p    
##  5 audi         a4         2.8  1999     6 auto(l~ f        16    26 p    
##  6 audi         a4         2.8  1999     6 manual~ f        18    26 p    
##  7 audi         a4         3.1  2008     6 auto(a~ f        18    27 p    
##  8 audi         a4 quat~   1.8  1999     4 manual~ 4        18    26 p    
##  9 audi         a4 quat~   1.8  1999     4 auto(l~ 4        16    25 p    
## 10 audi         a4 quat~   2    2008     4 manual~ 4        20    28 p    
## # ... with 224 more rows, and 1 more variable: class &lt;chr&gt;</code></pre>
<p>Se puede identificar con el tipo de variable: las categóricas son tipo chr y las continuas pueden ser de tipo int o dbl.</p>
<ol start="3" style="list-style-type: decimal">
<li>Dibuje una variable continua en color, tamaño y forma. Cómo se comportan estás estéticas para variables categóricas vs. variables continuas?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = cty))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Crea una paleta de colores.</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, size = cty))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Parece funcionar igual a que si fuera categórica ordinal aunque no es clara la leyenda en la formación de clases.</p>
<pre class="r"><code>#ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, shape = cty))</code></pre>
<p>No funciona.</p>
<ol start="4" style="list-style-type: decimal">
<li>Qué sucede si usted dibuja la misma variable para múltiples estéticas?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = class, size = class))</code></pre>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-21-1.png" width="672" /> Otro ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, alpha=class, color = class, size = class))</code></pre>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Aplica las tres estéticas, pero las tres dan la misma información.</p>
<ol start="5" style="list-style-type: decimal">
<li>Qué hace la estética stroke? (Ayuda: use ?geom_point)</li>
</ol>
<pre class="r"><code>#?geom_point</code></pre>
<p>stroke sirve para controlar el ancho del borde de algunos símbolos que se pueden usar para representar puntos en una gráfica. Se puede definir el ancho usando los valores de una variable numérica o usando un valor fijo. Por ejemplo usando la variable cyl:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, stroke = cyl), shape = 21)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Veamos ahora otro ejemplo usando un valor fijo:</p>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy), stroke = 2, shape = 24)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Con qué formas funciona?</p>
<p>Funciona con las formas de la 21 a la 25.</p>
<ol start="6" style="list-style-type: decimal">
<li>Qué sucede si usted dibuja una estética para algo más que un nombre de variable, tal como aes(color = displ &lt; 5)?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = displ &lt; 5))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Queda la estética aplicada a una indicadora de si se cumple o no el criterio establecido.</p>
</div>
<div id="facetas" class="section level2">
<h2>Facetas</h2>
<p>Las facetas es una forma de adicionar variables categóricas a una gráfica y consiste en crear subgráficas donde cada subgráfica muestra un subconjunto de los datos. hay dos formas de hacer esto. Si se quiere hacer facetas para una sola variable (que debería ser discreta) se usa facet_wrap(), por ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, nrow = 2)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Si lo que se quiere es realizar facetas para las combinaciones de dos variables se usa facet_wrap(), por ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_grid(drv ~ cyl)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Una variante del caso anterior es realizar facetas solo por filas o columnas, para lo cual se usa . en lugar del nombre de una de las variables, por ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_grid(. ~ cyl)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="ejercicios-2" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Qué sucede si usted hace facetas a una variable continua?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ cty, nrow = 2)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>Realiza una gráfica para cada valor de la variable continua.</p>
<ol start="2" style="list-style-type: decimal">
<li>Qué significan las celdas vacías en un gráfico con facet_grid(drv ~ cyl)?</li>
</ol>
<p>Las celdas vacías significan que no hay datos en el subconjunto de datos definido por la correspondiente combinación de niveles de las dos variables.</p>
<p>Como se relacionan con este gráfico?</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = drv, y = cyl))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Observe que el gráfico es un grid donde se marca con un punto donde hay datos, lo cual coincide con lo indicado en la gráfica con facet_grid(drv ~ cyl).</p>
<ol start="3" style="list-style-type: decimal">
<li>Qué gráficas hace el siguiente código?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_grid(drv ~ .)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_grid(. ~ cyl)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>La primera gráfica hace las facetas de la variable drv en las filas con ninguna variable en las columnas. La segunda gráfica hace las facetas de la variable cyl en las columnas con ninguna variable en las filas.</p>
<p>Que hace el .?</p>
<p>Indica en que dimensión (filas o columnas) no se tendrá ninguna variable.</p>
<ol start="4" style="list-style-type: decimal">
<li>Considerando la primera gráfica de esta sección:</li>
</ol>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, nrow = 2)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Cuáles son las ventajas de usar facetas en lugar de la estética color?</p>
<p>Ver el comportamiento separado de cada subconjunto de datos definido por la variable puesta en facetas.</p>
<p>Cuáles son las desventajas?</p>
<p>No veo desventajas.</p>
<p>Cómo podría cambiar el balance si se tiene un conjunto de datos más grande?</p>
<p>Con una base de datos mayor el gráfico usando la estética de color se vuelve difícil de leer.</p>
<ol start="5" style="list-style-type: decimal">
<li>Lea la ayuda ?facet_wrap.</li>
</ol>
<pre class="r"><code>#?facet_wrap</code></pre>
<p>Qué hace nrow?</p>
<p>Fija el número de filas para presentar las facetas de la variable class. Ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, nrow = 3)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Qué hace ncol?</p>
<p>Fija el número de columnas para presentar las facetas de la variable class.</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, ncol = 4)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Qué otras opciones controlan el diseño de los paneles individuales?</p>
<p>scales: permite definir las escalas de los paneles individuales, por defecto scales=“fixed”. Ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, ncol = 4, scales = &#39;free&#39;) # otras opciones: &#39;free_x&#39;, &#39;free_y&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>as.table: decide si las facetas se presentan como una tabla con los valores más altos en la parte inferior derecha, por defecto as.table = T. Ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, ncol = 4, as.table = F)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>strip.position: indica donde se colocan las etiquetas, por defecto strip.position = ‘top’ colocándolas arriba. Ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, ncol = 4, strip.position = &#39;bottom&#39;) # otras opciones: &#39;left&#39;, &#39;right&#39;.</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-40-1.png" width="672" /> drop: decide si muestra todos los niveles del factor no usados en los datos, por defecto drop = T. Ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, ncol = 4, drop = F)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>dir: indica la dirección que siguen las gráficas, por defecto dir = ‘h’. Ejemplo</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
facet_wrap(~ class, ncol = 4, dir = &#39;v&#39;)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>Por qué facet_grid() no tiene nrow y ncol?</p>
<p>Porque los valores para esos parámetros son tomados automáticamente del número de niveles de las variables que se combinan.</p>
<ol start="6" style="list-style-type: decimal">
<li>Cuando se usa facet_grid() usted debería colocar la variable con más niveles únicos en las columnas. Por qué?</li>
</ol>
<p>Porque hay más espacio para graficar en las columnas que en las filas.</p>
</div>
<div id="geometric-objects" class="section level2">
<h2>Geometric Objects</h2>
<p>En <strong>ggplot2</strong> se pueden usar diferentes objetos visuales para representar al mismo conjunto de datos, a ellos se les conoce como <em>geomas</em>. Un <em>geoma</em> es un objeto geométrico que es usado por una gráfica para representar los datos. Veamos un diagrama de dispersión de hwy vs. displ, que usa geom_point:</p>
<pre class="r"><code># left
ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>Ahora veamos una representación diferente que grafica una curva suavizada de hwy vs. displ junto con intervalos de confianza, que usa geom_smooth:</p>
<pre class="r"><code># right
ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>Una variante, donde se hacen ajustes en cada nivel de la variable categórica drv:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>ggplot2 proporciona más de 30 geomas, y un paquetes de extensión proporcionan aún más, ver <a href="https://www.ggplot2-exts.org" class="uri">https://www.ggplot2-exts.org</a> para una muestra. Para un resumen detallado consulte la hoja de trucos de ggplot2, que se puede encontrar en <a href="http://rstudio.com/cheatsheets" class="uri">http://rstudio.com/cheatsheets</a>. Para más detaller de un geoma use la ayuda ?geom_smooth.</p>
<p>Veamos nuevamente el uso de geom_smooth:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>para estos geomas se puede asignar la estética group a una variable categórica para dibujar múltiples objetos. Por ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>O tambien se puede asignar la estética color a una variable categórica dando como resultado:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_smooth(mapping = aes(x = displ, y = hwy, color = drv), show.legend = FALSE)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>Si se quieren agregar varios geomas a una gráfica basta con adicionarlos usando el signo +, así:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy)) +
geom_smooth(mapping = aes(x = displ, y = hwy))</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>Observe que hacer esto puede duplicar la cantidad de código (se repite aes(x = displ, y = hwy) en ambos geomas), para lo cual se usa la siguiente solución:</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point() +
geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>donde lo que se estaba repitiendo se deja en la función ggplot, quedando fijo para todos los geomas adicionados. Esto no impide que podamos agregar otras estéticas en los geomas adicionados (diferentes capas). Por ejemplo:</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(mapping = aes(color = class)) +
geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>La misma idea aplica si usted quiere especificar diferentes datos en cada capa. Por ejemplo, usemos una línea suavizada solo para vehículos de la clase sub-compactos:</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(mapping = aes(color = class)) +
geom_smooth(
data = filter(mpg, class == &quot;subcompact&quot;),
se = FALSE
)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
</div>
<div id="ejercicios-3" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Cuál geoma debería usarse para un gráfico de líneas?</li>
</ol>
<p><em>geom_line</em></p>
<p>Para un boxplot?</p>
<p><em>geom_boxplot</em></p>
<p>Para un histograma?</p>
<p><em>geom_histogram</em></p>
<p>Para un gráfico de áreas?</p>
<p><em>geom_area</em></p>
<ol start="2" style="list-style-type: decimal">
<li>Corra este código en su cabeza y prediga como lucirá la salida. Luego, corra el código en R y chequee sus predicciones:</li>
</ol>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) +
geom_point() +
geom_smooth(se = FALSE)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>wow… buenas predicciones…</p>
<ol start="3" style="list-style-type: decimal">
<li>Qué hace show.legend = FALSE?</li>
</ol>
<p>Quita la leyenda de la gráfica.</p>
<p>Que sucede si lo remueve?</p>
<p>Muestra la leyenda de la gráfica.</p>
<p>Por qué cree usted que lo usé antes en este capítulo?</p>
<p>Supongo que la usó para que las gráficas fueran comparables.</p>
<ol start="4" style="list-style-type: decimal">
<li>Qué hace el argumento se para geom_smooth()?</li>
</ol>
<p>Indica si la línea suavisada usando el método loess para los datos del ggplot se graficará con (se = T) o sin (se = F) los respectivos Intervalos de Confianza.</p>
<ol start="5" style="list-style-type: decimal">
<li>Lucirán diferentes las dos gráficas siguientes? Por qué/Por qué no?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point() +
geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<pre class="r"><code>ggplot() +
geom_point(
data = mpg,
mapping = aes(x = displ, y = hwy)
) +
geom_smooth(
data = mpg,
mapping = aes(x = displ, y = hwy)
)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>No lucen diferentes, por que los códigos son equivalentes.</p>
<ol start="6" style="list-style-type: decimal">
<li>Recree el código R necesario para generar las siguientes gráficas.</li>
</ol>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(size = 5) +
geom_smooth(size = 3, se = F)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_smooth(mapping=aes(group = drv), size = 3, se = F) +
geom_point(size = 5)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) +
geom_point(size = 5) +
geom_smooth(size = 3, se = F)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(mapping=aes(color = drv),size = 5) +
geom_smooth(size = 3, se = F)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(mapping=aes(color = drv),size = 5) +
geom_smooth(mapping=aes(linetype = drv), size = 3, se = F)</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
geom_point(shape = 21, colour = &quot;white&quot;, stroke = 10) +
geom_point(mapping=aes(color = drv), size = 7)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<div id="transformaciones-estadisticas" class="section level3">
<h3>Transformaciones Estadísticas</h3>
<p>Para ilustrar este tema considere una gráfica de barras para el conjunto de datos <em>diamonds</em> donde el número total de diamntes se agrupa por tipo de corte, variable <em>cut</em>.</p>
<pre class="r"><code>ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>Observe que el eje Y muestra una varible <em>count</em> que no está en el conjunto de datos, de manera que algunos gráficos calculan nuevos valores para graficar.</p>
<ul>
<li>Las gráficas de barras, histogramas y polígonos de frecuencias discretizan los datos en intervalos y luego grafican los conteos de cada intervalo.</li>
<li>Los suavizadores ajustan un modelo a los datos y grafican las predicciones del modelo.</li>
<li>Los boxplots calculan un resumen robusto de la distribución y muestran una caja con formato especial.</li>
</ul>
<p>El algoritmo usado para calcular los nuevos valores se denomina <em>stat</em> (statistical transformation). Para determinar cuál es la <em>stat</em> por defecto para un geoma particular basta con mirar la ayuda de éste último. Por ejemplo, mirando la ayuda ?geom_bar se observa que la <em>stat</em> por defecto para geom_bar() es <em>count</em> y en la sección de la ayuda “Computed variables” indica que se calculan dos nuevas variables <em>count</em> y <em>prop</em>. Las stats y los geoms se pueden usar de forma intercambiable, veamos como se puede replicar la gráfica de barras anterior esta vez usando stat_count() en lugar de geom_bar():</p>
<pre class="r"><code>ggplot(data = diamonds) + stat_count(mapping = aes(x = cut))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<ul>
<li>A continuación se muestra un ejemplo donde se quiere cambiar la <em>stat</em> por defecto de geom_bar() de <em>count</em> a <em>identity</em> cuando en el conjunto de datos la variable <em>y</em> ya contiene los conteos:</li>
</ul>
<pre class="r"><code>demo &lt;- tribble(
~a, ~b,
&quot;bar_1&quot;, 20,
&quot;bar_2&quot;, 30,
&quot;bar_3&quot;, 40
)
ggplot(data = demo) +
geom_bar(mapping = aes(x = a, y = b), stat = &quot;identity&quot;)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<ul>
<li>Otra posibilidad es cambiar el mapeo por defecto de variables transformadas para estéticas. Por ejemplo si se quiere mostrar una gráfica de barras de proporciones en lugar de conteos:</li>
</ul>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, y = ..prop.., group = 1)
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<ul>
<li>Ahora, usted puede interés en las transformaciones estadísticas. Por ejemplo, usemos stat_summary(), la cual resume los valores de <em>y</em> para cada valor único <em>x</em>:</li>
</ul>
<pre class="r"><code>ggplot(data = diamonds) +
stat_summary(
mapping = aes(x = cut, y = depth),
fun.ymin = min,
fun.ymax = max,
fun.y = median
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
</div>
</div>
<div id="ejercicios-4" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Cuál es el geoma por defecto asociado con stat_summary()?</li>
</ol>
<p><em>geom_pointrange</em></p>
<p>Cómo podría reescribir la gráfica anterios para usar <em>geom_pointrange</em> en lugar de la función <em>stat</em>?</p>
<pre class="r"><code>ggplot(data = diamonds) +
geom_pointrange(
  mapping = aes(x = cut, y = depth),
  fun.ymin = min,
  fun.ymax = max,
  fun.y = median,
  stat = &#39;summary&#39;)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Qué hace geom_col()? Cómo se diferencia de geom_bar()? geom_col grafica barras cuya altura representa los valores en los datos. A diferencia de geom_bar que grafica barras cuya altura es proporcional al número de casos en cada grupo. Ejemplo:</li>
</ol>
<pre class="r"><code>ggplot(data = demo) +
geom_col(mapping = aes(x = a, y = b))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>La mayoría de los geomas y stats vienen en pares que son casi siempre usados en sintonía. Lea la ayuda y haga una lista de todos los pares. Qué tienen en común?</li>
</ol>
<table>
<thead>
<tr class="header">
<th>geom</th>
<th>Useful stats (default in bold)</th>
<th>Default position adjustment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>blank</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>abline</td>
<td><strong>abline</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>abline</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>hline</td>
<td><strong>hline</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>hline</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>vline</td>
<td><strong>vline</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>vline</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>text</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>point</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>jitter</td>
<td><strong>identity</strong></td>
<td>jitter</td>
</tr>
<tr class="odd">
<td>segment</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>line</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>bar</td>
<td>identity</td>
<td>stack</td>
</tr>
<tr class="even">
<td>bar</td>
<td><strong>bin</strong></td>
<td>stack</td>
</tr>
<tr class="odd">
<td>histogram</td>
<td>alias for geom_bar</td>
<td></td>
</tr>
<tr class="even">
<td>area</td>
<td><strong>identity</strong></td>
<td>stack</td>
</tr>
<tr class="odd">
<td>ribbon</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>linerange</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>pointrange</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>errorbar</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>errorbarh</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>crossbar</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>boxplot</td>
<td>identity</td>
<td>dodge</td>
</tr>
<tr class="even">
<td>boxplot</td>
<td><strong>boxplot</strong></td>
<td>dodge</td>
</tr>
<tr class="odd">
<td>path</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>polygon</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>rect</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>rug</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>step</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>bin2d</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="odd">
<td>bin2d</td>
<td><strong>bin2d</strong></td>
<td>identity</td>
</tr>
<tr class="even">
<td>tile</td>
<td><strong>identity</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>hex</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>hex</td>
<td><strong>binhex</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>density</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>density</td>
<td><strong>density</strong>*</td>
<td>identity</td>
</tr>
<tr class="odd">
<td>density2d</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>density2d</td>
<td><strong>density2d</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>contour</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>contour</td>
<td><strong>contour</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>freqpoly</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>freqpoly</td>
<td><strong>bin</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>quantile</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>quantile</td>
<td><strong>quantile</strong></td>
<td>identity</td>
</tr>
<tr class="odd">
<td>smooth</td>
<td>identity</td>
<td>identity</td>
</tr>
<tr class="even">
<td>smooth</td>
<td><strong>smooth</strong></td>
<td>identity</td>
</tr>
</tbody>
</table>
<p>*: Las stats en negrilla son las por defecto.</p>
<p>La mayoria de geomas comparten el nombre de su stat, e.g. geom_contour() &lt;-&gt; stat_contour().</p>
<ol start="4" style="list-style-type: decimal">
<li>Cuáles variables calcula stat_smooth()?</li>
</ol>
<ul>
<li>y: valor predicho</li>
<li>ymin: límite inferior del IC puntual para la media</li>
<li>ymax: límite superior del IC puntual para la media</li>
<li>se: error estándar de y</li>
</ul>
<p>Cuáles parámetros controlan su comportamiento?</p>
<ul>
<li>method: indica el método de suavizamiento a usar</li>
<li>formula: especifica una formula para ser usada en el suavizamiento</li>
<li>se: especifica si se muestran o no los IC’s</li>
<li>n: número de puntos a ser evaluados por el suavizador</li>
<li>span: controla el suavizado</li>
<li>level: especifica el nivel de confianza</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>En la gráfica de barras de proporciones se necesita colocar group = 1. Por qué?</li>
</ol>
<p>La estética group en geom_bar, por defecto agrupa por los valores de la variable x, de manera que la proporción de diamantes cortados en cualquier categoría con respecto a la misma categoría siempre será el 100%. Por eso es necesario especificar group = 1, que indica que las proporciones se tomarán respecto del total de diamantes cortados.</p>
<p>En otras palabras cuál es el problema con estos dos gráficos?</p>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, y = ..prop..))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, fill = color, y = ..prop..)
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>En la primera gráfica se toma el valor por defecto para la estética group con el resultado antes discutido.</p>
<p>En la segunda gráfica al especificar el relleno con los valores de la variable color, la estética group por defecto considera los grupos formados por las combinaciones de los niveles de variables categóricas, quedando en cada grupo de cut los siete grupos de color (35 grupos en total), pero las proporciones las calcula para los diamantes en cada grupo con respecto a los diamantes en cada grupo, de manera que siempre dan el 100%.</p>
</div>
<div id="ajustes-de-posicion" class="section level2">
<h2>Ajustes de posición</h2>
<p>Las gráficas de barras de pueden colorear usando la estética color o la más útil fill:</p>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, color = cut))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, fill = cut))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<p>Veamos que pasa cuando se asocia la estética fill a una variable, como clarity: las barras son automáticamente apiladas:</p>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, fill = clarity))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Cada rectángulo coloreado representa una combinación de cut y clarity. El apilado es realizado automaticamente por por el ajuste de posición especificado por el argumento position. Si no se quieren barras apiladas, se pueden usar una de las otras tres opciones:</p>
<ul>
<li>position = ‘identity’: colocará cada objeto exactamente donde cae en el contexto de la gráfica. Esto no es útil para barras puesto que quedan superpuestas, para ver esto se requiere algo de transparencia usando alpha pequeño o sin relleno (fill = NULL). Por ejemplo, usando alpha:</li>
</ul>
<pre class="r"><code>ggplot(
data = diamonds,
mapping = aes(x = cut, fill = clarity)
) +
geom_bar(alpha = 1/5, position = &quot;identity&quot;)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>o usando fill = NULL:</p>
<pre class="r"><code>ggplot(
data = diamonds,
mapping = aes(x = cut, color = clarity)
) +
geom_bar(fill = NA, position = &quot;identity&quot;)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>position = ‘identity’ es más útil en geomas en 2D como geom_point, para el cual es la posición por defecto.</p>
<ul>
<li>position = ‘fill’: consiste en un apilado haciendo que las barras apiladas tengan la misma altura, permitiendo comparar fácilmente las proporciones entre grupos. Por ejemplo:</li>
</ul>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, fill = clarity),
position = &quot;fill&quot;
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<ul>
<li>position = ‘dodge’: coloca los objetos superpuestos directamente al lado del otro, permitiendo comparar fácilmente valores individuales. Por ejemplo:</li>
</ul>
<pre class="r"><code>ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, fill = clarity),
position = &quot;dodge&quot;
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>Hay otro tipo de ajuste que no es útil para gráficas de barras pero que puede ser muy útil para diagramas de dispersión. Recuerde el primer diagrama de dispersión.</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy))</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>Notó que la gráfica solo muestra 126 puntos aún cuando hay 234 observaciones en el conjunto de datos?. Esto ocurre por que los valores están redondeados, de manera que hay puntos superpuestos. Esto no permite visualizar la masa de los datos. Será que los valores superpuestos se dispersan equitativamente por la gráfica, o hay una combinación de las variables que contiene los 109 valores ocultos?. Una solución para esto es usar position = ‘jitter’: que adiciona un pequeño ruido aleatorio a cada punto. Veamos:</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_point(
mapping = aes(x = displ, y = hwy),
position = &quot;jitter&quot;
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>Agregar aleatoriedad hace que tu gráfica sea menos precisa a escalas pequeñas, pero a gran escala, hace que tu gráfica sea más reveladora. Esta operación puede ser tan útil que ggplot2 abrevió geom_point(position = “jitter”) en geom_jitter().</p>
<p>Para más información sobre los ajustes de posición use ?position_dodge, ?position_fill, ?position_identity, ?position_jitter y ?position_stack.</p>
</div>
<div id="ejercicios-5" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Cuál es el problema de esta gráfica?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
geom_point()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>La distribución de los puntos que se asemeja a una malla indica que hay puntos superpuestos.</p>
<p>Como podría mejorarla?</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
geom_jitter()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Cuáles parámetros de geom_jitter() controlan la cantidad de variación?</li>
</ol>
<p>width y height</p>
<ol start="3" style="list-style-type: decimal">
<li>Compare y contraste geom_jitter() con geom_count().</li>
</ol>
<p>Veamos el mismo ejemplo usado antes para geom_jitter usando ahora geom_count:</p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
geom_count()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Cuál es el ajuste de posición por defecto para geom_boxplot()?</li>
</ol>
<p>dodge</p>
<p>Cree una visualización del conjunto de datos mpg que lo demuestre.</p>
<pre class="r"><code>ggplot(data = mpg) +
geom_boxplot(
mapping = aes(x = drv, y = cty), fill = &#39;blue&#39;
)</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
</div>
<div id="sistemas-coordenados" class="section level2">
<h2>Sistemas coordenados</h2>
<p>Esto es quizás lo más complejo de ggplot2. El sistema coordenado por defecto es el cartesiano. Hay otros tipos de sistemas coordenados que ocasionalmente pueden ser útiles:</p>
<ul>
<li>coord_flip() intercambia los ejes x e y, que puede ser util para obtener boxplots horizontales, o cuando se tienen etiquetas largas que se superponen en el eje x. Por ejemplo:</li>
</ul>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = class, y = hwy)) +
geom_boxplot()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = class, y = hwy)) +
geom_boxplot() +
coord_flip()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<ul>
<li>coord_quickmap(): establece la razón de aspecto apropiadamente para mapas, lo cual es importante para datos espaciales. Por ejemplo:</li>
</ul>
<pre class="r"><code>#nz &lt;- map_data(&quot;nz&quot;)
#ggplot(nz, aes(long, lat, group = group)) +
#geom_polygon(fill = &quot;white&quot;, color = &quot;black&quot;)</code></pre>
<pre class="r"><code>#ggplot(nz, aes(long, lat, group = group)) +
#geom_polygon(fill = &quot;white&quot;, color = &quot;black&quot;) +
#coord_quickmap()</code></pre>
<ul>
<li>coord_polar(): usa coordenadas polares. Un ejemplo de su uso es revelar la conección entre las gráficas de barras y una gráfica Coxcomb:</li>
</ul>
<pre class="r"><code>bar &lt;- ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, fill = cut),
show.legend = FALSE,
width = 1
) +
theme(aspect.ratio = 1) +
labs(x = NULL, y = NULL)</code></pre>
<pre class="r"><code>bar + coord_flip()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<pre class="r"><code>bar + coord_polar()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
</div>
<div id="ejercicios-6" class="section level2">
<h2>Ejercicios</h2>
<ol style="list-style-type: decimal">
<li>Convierta una gráfica de barras apiladas en un diagrama de torta usando coord_polar().</li>
</ol>
<pre class="r"><code>p &lt;- ggplot(data = diamonds) +
geom_bar(
mapping = aes(x = cut, fill = clarity),
position = &quot;fill&quot;
)</code></pre>
<pre class="r"><code>p + coord_polar()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Qué hace labs()? Lea la ayuda.</li>
</ol>
<p>Sirve para modificar las etiquetas de los ejes, de la leyenda y de la gráfica.</p>
<ol start="3" style="list-style-type: decimal">
<li>Cuál es la diferencia entre coord_quickmap() y coord_map()?</li>
</ol>
<p>Ambos sistemas de coordenadas sirven para proyectar una porción de la tierra pero coord_quickmap se usa cuando se está cerca al ecuador como una aproximación de lo que hace coord_map, ya que este proceso en general requieres una computación considerable.</p>
<ol start="4" style="list-style-type: decimal">
<li>Qué le dice la siguiente gráfica acerca de la relación entre las millas por galón en la ciudad (cty) y en la autopista (hwy)?</li>
</ol>
<pre class="r"><code>ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
geom_point() +
geom_abline() +
coord_fixed()</code></pre>
<p><img src="Cap1_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>Que las mpg en la ciudad siempre son menores que en la autopista.</p>
<p>Por qué es importante coord_fixed()?</p>
<p>Porque hace que los ejes x e y tengan la misma relación de aspecto.</p>
<p>Qué hace geom_abline()?</p>
<p>Traza por defecto una recta imagen y = x.</p>
</div>
<div id="la-gramatica-por-capas-de-las-graficas" class="section level2">
<h2>La gramática por capas de las gráficas</h2>
<p>Se trata de una plantilla para hacer gráficas en ggplot2 donde se resume todo lo aprendido en este capítulo:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
